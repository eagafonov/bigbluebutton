<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
        <head>
                <title></title>
                <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
                <style type="text/css" media="screen">
                        html, body, #content    { height:100%; }
                        body                                    { margin:0; padding:0; overflow:hidden; }
                        #altContent                             { /* style alt content */ }
                        .applet {width:1px; height:1px;}
                </style>
                <script src="lib/jquery-1.5.1.min.js" language="javascript"></script>

                <script language="javascript">
                    function guidGenerator() {
                        var S4 = function() {
                        return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
                        };
                        return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());
                    }


                    gRoom = guidGenerator();

                    gServerHost = window.location.hostname;

                    rtmp_url = "rtmp://"+gServerHost+":3935/deskShare";

                    gLink = 'DeskshareStandalone.html#HOST='+rtmp_url+';ROOM='+gRoom;

                    function createApplet(containerId, host, port, room) {
                        id = containerId + "_applet"+Math.floor(Math.random() * 100000000);

                        var handler = {
                                id:id,
                                onAppletCreate: null,
                                onAppletStart:  null,
                                onAppletStop:  null,
                                onShareStart: null
                            };

                        window.bbbDeskshare.addHandler(id, handler);

                        var applet = $("<applet>").attr('code', 'org.bigbluebutton.deskshare.client.DeskShareApplet.class')
                                                  .attr('archive', 'bbb-deskshare-applet-0.8.jar')
                                                  .attr('id', id)
                                                  .addClass('applet');

                        $("<param/>").attr('name', 'ID').attr('value', id).appendTo(applet);
                        $("<param/>").attr('name', 'ROOM').attr('value', room).appendTo(applet);
                        $("<param/>").attr('name', 'IP').attr('value', host).appendTo(applet);
                        $("<param/>").attr('name', 'PORT').attr('value', port).appendTo(applet);
                        $("<param/>").attr('name', 'FULLSCREEN').attr('value', 'fullscreen').appendTo(applet);


                        $("#" + containerId).append(applet);

                        return handler;
                    }

                    function addApplet(containerId, host, port, room) {
                        var handler = createApplet(containerId, host, port, room);


                        $("#mydesktop_link").attr('href', gLink).text(gLink);

                        return handler;
                    }

                    function stopApplet(containerId) {
                        var applet = $("#" + containerId + "_applet");
                        $("#" + containerId).empty();
                        $("#mydesktop_link").removeAttr('href').empty();
                    }

                    $(document).ready(function() {
                            $("#mydesktop_link").removeAttr('href').empty();
                        })

                    // returns an object
                    function testObject() {
                        this.f = function() {
                            console.log("testObject.f()");
                        }
                    }

                    function Wrapper() {
                        this.hello = function() {
                            console.log("Wrapper.hello()");
                        }

                        this.addHandler = function(appletId, handler) {
                            this.handlers[appletId] = handler;
                        }

                        this.handlers = {};
                    };

                    window.bbbDeskshare = new Wrapper();

                    gHandler = {
                        onAppletCreate: function() {
                            console.log("[Applet] Created");
                        },
                        onAppletStart: function() {
                            console.log("[Applet] Started");
                        },
                        onAppletStop: function() {
                            console.log("[Applet] Stopped");
                        },
                        onShareStart: function() {
                            console.log("[Applet] Share started");
                        }
                    }

                    function addApplet2() {
                        var handler = addApplet("appletContainer", gServerHost, 9123, gRoom);
                        console.log("Applet added", handler);

                        handler.onAppletCreate = function() {console.log("[Applet] Created", this.id);};
                        handler.onAppletStart = function() {console.log("[Applet] Started", this.id);};
                        handler.onAppletStop =  function() {console.log("[Applet] Stopped", this.id);},
                        handler.onShareStart = function() {console.log("[Applet] Share started", this.id);}

                        console.log("Updated handler", handler);
                    }

				</script>

        </head>
        <body>
                <input type='submit' value='Start desktop sharing' onclick='addApplet2()' />
                <input type='submit' value='Stop desktop sharing' onclick='stopApplet("appletContainer")' />
                <div>
                <a id='mydesktop_link' target='_blank'>!!SETUPME</a>
                </div>
                <div id='appletContainer' />

        </body>
</html>
