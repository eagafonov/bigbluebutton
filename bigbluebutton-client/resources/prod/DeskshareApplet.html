<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
        <head>
                <title></title>
                <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
                <style type="text/css" media="screen">
                        html, body, #content    { height:100%; }
                        body                                    { margin:0; padding:0; overflow:hidden; }
                        #altContent                             { /* style alt content */ }
                        .applet {width:1px; height:1px;}
                </style>
                <script src="lib/jquery-1.5.1.min.js" language="javascript"></script>
                <script src="lib/bbb_deskshare_applet.js" language="javascript"></script>

                <script language="javascript">
                    function guidGenerator() {
                        var S4 = function() {
                        return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
                        };
                        return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());
                    }


                    gRoom = guidGenerator();

                    gServerHost = window.location.hostname;

                    rtmp_url = "rtmp://"+gServerHost+":3935/deskShare";

                    gLink = 'DeskshareStandalone.html#HOST='+rtmp_url+';ROOM='+gRoom;

                    var gAppletCtrl = null;

                    function addApplet(containerId, host, port, room) {
                        gAppletCtrl = bbbDeskshare.createApplet(containerId, host, port, room);

                        console.log("Applet added", gAppletCtrl);

                        gAppletCtrl.onAppletInit = function() {console.log("[Applet] Created", this.id);};
                        gAppletCtrl.onAppletStart = function() {console.log("[Applet] Started", this.id);};
                        gAppletCtrl.onAppletStop =  function() {console.log("[Applet] Stopped", this.id);},
                        gAppletCtrl.onShareStart = function() {console.log("[Applet] Share started", this.id);}

                        console.log("Updated handler", gAppletCtrl);

                        $("#mydesktop_link").attr('href', gLink).text(gLink);
                    }

                    function stopApplet(containerId) {
                        gAppletCtrl.remove();
                        gAppletCtrl = null;

                        $("#mydesktop_link").removeAttr('href').empty();
                    }

                    $(document).ready(function() {
                            $("#mydesktop_link").removeAttr('href').empty();

                            console.log(bbbDeskshare);
                        })

                    function addApplet2() {
                        if (gAppletCtrl === null) {

                            // Option 1: ID of container object
                            // addApplet("appletContainer", gServerHost, 9123, gRoom);

                            // Option 2: container as jQuery DOM Element
                            addApplet(jQuery("#appletContainer"), gServerHost, 9123, gRoom);

                        } else {
                            console.log("Applet is already created. Stop it before creating new one");
                        }
                    }

				</script>

        </head>
        <body>
                <input type='submit' value='Start desktop sharing' onclick='addApplet2()' />
                <input type='submit' value='Stop desktop sharing' onclick='stopApplet("appletContainer")' />
                <div>
                <a id='mydesktop_link' target='_blank'>!!SETUPME</a>
                </div>
                <div id='appletContainer' />

        </body>
</html>
